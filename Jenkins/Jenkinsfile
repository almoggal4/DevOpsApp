pipeline {
    agent any
    stages {
        stage('Create External Infrastructure') {
            steps {
                echo 'Create/Comply the exteranl infrastructre in AWS and Kubernetes using Terraform and Ansible'
                sh 'ssh-keygen -f "/root/.ssh/known_hosts" -R "terraform-aws"'
                sh 'ssh -o StrictHostKeyChecking=no -i /root/.ssh/id_rsa jenkins-remote-user@terraform-aws "cd /Terraform/TerraformAWSInfrastructure/TerraformApp && ./terraform_deploy.sh"'
                "!!!!!!!!!!!!!!!!!!!!!!!!! create bash script to check terraform plan and then apply"
            }
        }

        stage('Build') {
            steps {
                echo 'Building...'
                echo 'service docker start'
            }
        }
        stage('Push') {
            steps {
                echo 'Push image to docker registery...'
            }
        }
        stage('Test') {
            steps {
                echo 'Testing...'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying...'
            }
        }
    }
}